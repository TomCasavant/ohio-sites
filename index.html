<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ohio Sites Directory</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    input, select { margin: 0.5rem; padding: 0.3rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    tr:nth-child(even) { background: #f9f9f9; }
    .tag { display: inline-block; background: #eef; padding: 0.2rem 0.4rem; margin: 0.1rem; border-radius: 3px; font-size: 0.8em; }
  </style>
</head>
<body>

<h1>Ohio Sites Directory</h1>
<button id="randomUrl">ðŸŽ² Open Random Site</button>
<input type="text" id="search" placeholder="Search..." />
<select id="tagFilter">
  <option value="">All Tags</option>
</select>

<table id="dataTable">
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Link</th>
      <th>Feed</th>
      <th>Category</th>
      <th>Location</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let data = [];
  let allTags = new Set();

  async function loadData() {
    const res = await fetch('ohio.json');
    data = await res.json();

    data.forEach(row => {
      (row.category || "").split(",").forEach(tag => {
        const trimmed = tag.trim();
        if (trimmed) allTags.add(trimmed);
      });
    });

    const tagSelect = document.getElementById('tagFilter');
    [...allTags].sort().forEach(tag => {
      const option = document.createElement('option');
      option.value = tag;
      option.textContent = tag;
      tagSelect.appendChild(option);
    });

    renderTable();
  }

  function renderTable() {
    const tbody = document.querySelector('#dataTable tbody');
    tbody.innerHTML = '';

    const searchVal = document.getElementById('search').value.toLowerCase();
    const selectedTag = document.getElementById('tagFilter').value;

    data.forEach(row => {
      const rowText = Object.values(row).join(' ').toLowerCase();
      const tags = (row.category || "").split(",").map(t => t.trim());

      const matchesSearch = !searchVal || rowText.includes(searchVal);
      const matchesTag = !selectedTag || tags.includes(selectedTag);

      if (matchesSearch && matchesTag) {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${row.title}</td>
          <td>${row.description || row.url}</td>
          <td><a href="${row.link}" target="_blank">Link</a></td>
          <td><a href="${row.url}" target="_blank">${row.url_type}</a></td>
          <td>${tags.map(t => `<span class="tag">${t}</span>`).join(' ')}</td>
          <td>${row.location || row.alt_location}</td>
        `;

        tbody.appendChild(tr);
      }
    });
  }

  document.getElementById('search').addEventListener('input', renderTable);
  document.getElementById('tagFilter').addEventListener('change', renderTable);

  document.getElementById('randomUrl').addEventListener('click', () => {
    const urlOptions = data.filter(row => (row.url_type || '').toLowerCase() === 'url' && row.url);
    
    if (urlOptions.length === 0) {
      alert("No sites with url_type='url' found.");
      return;
    }
  
    const randomRow = urlOptions[Math.floor(Math.random() * urlOptions.length)];
    window.open(randomRow.url, '_blank');
  });

  loadData();
</script>

</body>
</html>
